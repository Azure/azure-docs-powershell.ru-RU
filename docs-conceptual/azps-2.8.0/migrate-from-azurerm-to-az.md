---
title: Перенос скриптов Azure PowerShell с AzureRM на Az
description: Сведения о действиях и инструментах для переноса скриптов с модуля AzureRM на новый модуль Az.
ms.devlang: powershell
ms.topic: conceptual
ms.date: 05/10/2019
ms.custom: devx-track-azurepowershell
ms.service: azure-powershell
ms.openlocfilehash: a0a6fcbc0a7bdae507ff5e16dd844e8425c929d5
ms.sourcegitcommit: 2036538797dd088728aee5ac5021472454d82eb2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2020
ms.locfileid: "93410372"
---
# <a name="migrate-azure-powershell-from-azurerm-to-az"></a>Перенос Azure PowerShell с AzureRM на Az

Модуль Az имеет равенство функций с AzureRM, но использует более короткие и единообразные имена командлетов.
Скрипты, написанные для командлетов AzureRM, не смогут автоматически работать с новым модулем. Для упрощения перехода модуль Az предлагает средства, позволяющие запускать существующие скрипты, которые используют AzureRM. Миграция всегда сопряжена со сложностями, но эта статья поможет вам начать переход на новый модуль с новым набором команд.

Полный список критических изменений между AzureRM и Az см. [здесь](migrate-az-1.0.0.md).

## <a name="ensure-existing-scripts-work-with-the-latest-azurerm-release"></a>Убедитесь, что существующие скрипты работают с последним выпуском AzureRM

Перед выполнением любых действий миграции проверьте, какие версии AzureRM установлены в вашей системе. Это позволит проверить, запущены ли скрипты с последним выпуском, и поможет узнать, какие версии AzureRM необходимо удалить.

Чтобы проверить установленную версию (версии) AzureRM, выполните приведенную ниже команду.

```powershell-interactive
Get-InstalledModule -Name AzureRM -AllVersions
```

__Последний__ доступный выпуск AzureRM — __6.13.1__. Если у вас нет этой версии, возможно, ваши существующие скрипты нужно будет дополнительно изменить для работы с модулем Az, помимо тех изменений, которые описаны здесь и в [списке критических изменений](migrate-az-1.0.0.md).

Если скрипты не работают с AzureRM 6.13.1, обновите их в соответствии с [руководством по переходу AzureRM с версии 5.x на 6.x](/powershell/azure/azurerm/migration-guide.6.0.0).
Если вы используете более раннюю версию модуля AzureRM, найдите нужное руководство. Руководства по миграции существуют для каждого основного номера версии.

## <a name="uninstall-azurerm"></a>Удаление AzureRM

Модуль Az не обязательно будет совместим с любой существующей установкой AzureRM в PowerShell 5.1 для Windows. Перед установкой модуля Az [удалите AzureRM](/powershell/azure/uninstall-az-ps#uninstall-the-azurerm-module).

> [!IMPORTANT]
>
> Если вы не готовы удалить модуль AzureRM из системы, можно установить модуль Az для [PowerShell Core](/powershell/scripting/install/installing-powershell-core-on-windows) 6.x или более поздней версии. PowerShell Core и PowerShell 5.1 для Windows используют разные библиотеки модуля, что позволяет избежать конфликтов. Вы также сможете [включить псевдонимы](#enable-azurerm-compatibility-aliases) в PowerShell Core.

## <a name="install-the-azure-powershell-az-module"></a>Установка модуля Az для Azure PowerShell

Первый шаг — это установка модуля Az на вашей платформе. При установке модуля Az рекомендуется удалить AzureRM. В последующих разделах вы узнаете, как продолжить использовать существующие скрипты и активировать режим совместимости со старыми именами командлетов.

Чтобы установить модуль Az для Azure PowerShell, следуйте инструкциям, приведенным [здесь](install-az-ps.md).

> [!NOTE]
> На этом этапе можно запустить командлет [Uninstall-AzureRM](/powershell/module/az.accounts/uninstall-azurerm) в модуле Az, чтобы убедиться, что все версии AzureRM были удалены и не приведут к конфликтам.

## <a name="enable-azurerm-compatibility-aliases"></a>Включение псевдонимов совместимости AzureRM

Благодаря удаленной AzureRM и скриптам, работающим с последней версией AzureRM, можно активировать режим совместимости для модуля Az. Режим совместимости активируется следующей командой:

```powershell-interactive
Enable-AzureRmAlias -Scope CurrentUser
```

Псевдонимы позволяют использовать старые имена командлетов с установленным модулем Az. Эти псевдонимы записываются в профиль для выбранной области видимости. Если профиль отсутствует, он будет создан.
При использовании более широкой области, чем `-Scope` со значением `CurrentUser`, требуются соответствующие разрешения для создания или обновления соответствующего файла профиля.

> [!IMPORTANT]
> Псевдонимы используются __только__ для имен командлетов, но не для имен модулей. Если вы используете `#Requires`, `Import-Module`, списки зависимостей в файле `.psd1` или полные имена командлетов, перенесите их на этом этапе, выполнив описанный в [списке критических изменений](migrate-az-1.0.0.md) процесс, касающийся имен модулей.

> [!WARNING]
>
> Можно использовать другое значение параметра `-Scope` для этой команды, но делать это не рекомендуется. Псевдонимы записываются в профиль пользователя для выбранной области видимости, поэтому используйте их для как можно более узкой области. Активация псевдонимов для всей системы может вызвать проблемы у других пользователей, которые установили AzureRM в свою локальную область.

После активации режима псевдонимов запустите скрипты снова, чтобы убедиться, что они по-прежнему работают правильно.
Модуль Az изменил, добавил или сделал обязательными некоторые имена параметров. Типы выходных данных командлетов также могли измениться. Эти критические изменения описаны [здесь](migrate-az-1.0.0.md).

## <a name="update-cmdlets-modules-and-parameters"></a>Обновления командлетов, модулей и параметров

При наличии обновленных скриптов, которые запущены под псевдонимами, обновите их для использования новых командлетов и испытайте другие изменения, в частности новые возможности. Для большинства скриптов достаточно только обновить имена командлетов, [следуя новой схеме именования командлетов в Az](migrate-az-1.0.0.md#cmdlet-noun-prefix-changes). Могут быть и другие изменения, которые необходимо внести, чтобы скрипт заработал, в зависимости от того, какие действия он выполняет и какие компоненты Azure PowerShell он использует.

Например, [командлеты хранилища BLOB-объектов](migrate-az-1.0.0.md#azstorage-previously-azurestorage-and-azurermstorage) полностью переработаны для применения новой асинхронной модели, поэтому скрипты, использующие их, будет сложнее обновить, чем те, где были изменены только имена командлетов.

Даже если вам пришлось пока только сделать небольшие простые изменения скриптов или они работают без дополнительной модификации при включенной поддержке псевдонимов, прочтите [полный список критических изменений в Az 1.0.0](migrate-az-1.0.0.md), чтобы убедиться в том, что вы не используете "прозрачное" поведение псевдонимов, которое может исчезнуть после изменения имен командлетов и отключения псевдонимов.

## <a name="disable-aliases"></a>Отключение псевдонимов

После завершения миграции и устранения зависимости от поведения псевдонимов рекомендуется отключить псевдонимы. Это делается с помощью командлета [Disable-AzureRmAlias](/powershell/module/az.accounts/disable-azurermalias).

> [!IMPORTANT]
> При выполнении этого командлета убедитесь, что __вызвали его__ для каждого параметра `-Scope`, для которого был вызван командлет `Enable-AzureRmAlias`, в противном случае в системе могут по-прежнему существовать скрипты, использующие поведения псевдонимов.
